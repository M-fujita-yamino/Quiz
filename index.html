// --- ä¿®æ­£ç‰ˆJavaScript ---
const quizData = {
    name: "ä½è—¤è¼æ˜Ž", 
    keywords: ["ä½è—¤è¼æ˜Ž", "ã‚µãƒˆã‚¦ãƒ†ãƒ«ã‚¢ã‚­", "ã‚µãƒˆã‚¦", "ãƒ†ãƒ«", "ä½è—¤"]
};

const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
const recognition = new SpeechRecognition();
recognition.lang = 'ja-JP';
recognition.continuous = false; // é€£ç¶šèªè­˜ã‚’ã‚ªãƒ•ã«ã™ã‚‹
recognition.interimResults = false;

const micBtn = document.getElementById('mic-btn');
const resultText = document.getElementById('result-text');
const statusText = document.getElementById('status');

// ãƒžã‚¤ã‚¯é–‹å§‹
micBtn.onmousedown = () => {
    try {
        recognition.start();
        statusText.innerText = "è´ã„ã¦ã„ã¾ã™...å–‹ã£ã¦ãã ã•ã„";
        micBtn.style.background = "#e74c3c";
    } catch (e) {
        // äºŒé‡èµ·å‹•ã‚¨ãƒ©ãƒ¼é˜²æ­¢
        console.log(e);
    }
};

// ãƒžã‚¤ã‚¯çµ‚äº†ï¼ˆæŒ‡ã‚’é›¢ã—ãŸã¨ãï¼‰
micBtn.onmouseup = () => {
    // å°‘ã—é…ã‚‰ã›ã¦ã‚¹ãƒˆãƒƒãƒ—ã•ã›ã‚‹ã“ã¨ã§ã€æœ€å¾Œã®è¨€è‘‰ã‚’æ‹¾ã„ã‚„ã™ãã™ã‚‹
    setTimeout(() => {
        recognition.stop();
        statusText.innerText = "åˆ¤å®šã—ã¾ã—ãŸ";
        micBtn.style.background = "#2ecc71";
    }, 500);
};

// çµæžœãŒå‡ºãŸã¨ã
recognition.onresult = (event) => {
    const transcript = event.results[0][0].transcript;
    resultText.innerText = "ã‚ãªãŸã®å›žç­”: " + transcript;

    const isCorrect = quizData.keywords.some(keyword => transcript.includes(keyword));

    if (isCorrect) {
        resultText.style.color = "#27ae60";
        resultText.innerText += " ðŸŽ‰ æ­£è§£ï¼";
    } else {
        resultText.style.color = "#e74c3c";
        resultText.innerText += " âŒ æ®‹å¿µ";
    }
};

// ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
recognition.onerror = (event) => {
    console.error("Speech recognition error:", event.error);
    statusText.innerText = "ã‚¨ãƒ©ãƒ¼: " + event.error;
    micBtn.style.background = "#2ecc71";
};
