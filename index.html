// --- ä¿®æ­£ç‰ˆJavaScript (ãƒ©ãƒ³ãƒ€ãƒ å‡ºé¡Œãƒ»CSVå¯¾å¿œ) ---

let celebrities = []; // CSVã‹ã‚‰èª­ã¿è¾¼ã‚“ã ãƒ‡ãƒ¼ã‚¿ã‚’æ ¼ç´ã™ã‚‹é…åˆ—
let currentQuiz = null;

// 1. Googleã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆ(CSV)ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚€é–¢æ•°
async function loadCelebrityData() {
    const csvUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSU6s1sEI6R3RXqbdaR0am_PucJfqDyrMAY0NksHGMqzp_UJG-pwIkdvIXW5PuTdKbdPA7ztYDFUg_X/pub?gid=0&single=true&output=csv'; 
    try {
        const response = await fetch(csvUrl);
        const csvText = await response.text();
        
        // CSVã‚’1è¡Œãšã¤åˆ†å‰²ã—ã¦é…åˆ—ã«å¤‰æ›
        const rows = csvText.split('\n').slice(1); // 1è¡Œç›®ï¼ˆãƒ˜ãƒƒãƒ€ãƒ¼ï¼‰ã‚’é£›ã°ã™
        celebrities = rows.map(row => {
            const cols = row.split(',');
            return {
                name: cols[0],
                keywords: cols[1] ? cols[1].split('/') : [], // ã€Œ/ã€åŒºåˆ‡ã‚Šã§ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ç®¡ç†
                img: cols[2]
            };
        });
        
        nextQuiz(); // èª­ã¿è¾¼ã¿å®Œäº†å¾Œã«æœ€åˆã®ã‚¯ã‚¤ã‚ºã‚’è¡¨ç¤º
    } catch (e) {
        console.error("ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿å¤±æ•—", e);
    }
}

// 2. ãƒ©ãƒ³ãƒ€ãƒ ã«æ¬¡ã®å•é¡Œã‚’è¡¨ç¤ºã™ã‚‹é–¢æ•°
function nextQuiz() {
    if (celebrities.length === 0) return;
    
    // ãƒ©ãƒ³ãƒ€ãƒ ã«1ã¤é¸æŠ
    const randomIndex = Math.floor(Math.random() * celebrities.length);
    currentQuiz = celebrities[randomIndex];
    
    // ç”»é¢ã‚’æ›´æ–°
    document.getElementById('celeb-img').src = currentQuiz.img;
    document.getElementById('result-text').innerText = "ï¼ˆå›ç­”ã‚’å¾…ã£ã¦ã„ã¾ã™ï¼‰";
    document.getElementById('result-text').style.color = "black";
}

// 3. éŸ³å£°èªè­˜ã®çµæœåˆ¤å®šï¼ˆå‰å›ã®ãƒ­ã‚¸ãƒƒã‚¯ã‚’æµç”¨ï¼‰
recognition.onresult = (event) => {
    const transcript = event.results[0][0].transcript;
    document.getElementById('result-text').innerText = "ã‚ãªãŸã®å›ç­”: " + transcript;

    // ç¾åœ¨ã®å•é¡Œã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã¨ç…§åˆ
    const isCorrect = currentQuiz.keywords.some(keyword => transcript.includes(keyword));

    if (isCorrect) {
        document.getElementById('result-text').style.color = "#27ae60";
        document.getElementById('result-text').innerText += " ğŸ‰ æ­£è§£ï¼";
        // 2ç§’å¾Œã«è‡ªå‹•ã§æ¬¡ã®å•é¡Œã¸
        setTimeout(nextQuiz, 2000);
    } else {
        document.getElementById('result-text').style.color = "#e74c3c";
        document.getElementById('result-text').innerText += " âŒ æ®‹å¿µ";
    }
};

// èµ·å‹•æ™‚ã«ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚€
loadCelebrityData();
