<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8"><title>æœ‰åäººå½“ã¦ã‚¯ã‚¤ã‚º</title>
    <style>
        body { font-family: sans-serif; text-align: center; background: #f4f7f6; padding: 20px; }
        .card { background: white; padding: 20px; border-radius: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); max-width: 400px; margin: auto; }
        .img-box { width: 100%; height: 300px; background: #eee; display: flex; align-items: center; justify-content: center; margin-bottom: 15px; }
        img { max-width: 100%; max-height: 100%; object-fit: contain; }
        .btn { width: 90%; padding: 15px; margin: 5px; border-radius: 50px; border: none; cursor: pointer; font-size: 1rem; }
    </style>
</head>
<body>
<div class="card">
    <div id="status" style="font-size:0.7rem; color:gray;">æ¥ç¶šä¸­...</div>
    <div class="img-box"><img id="q-img" src=""></div>
    <div id="res" style="font-weight:bold; min-height:2em;"></div>
    <button id="mic-btn" class="btn" style="background:#2ecc71; color:white;">ğŸ™ é•·æŠ¼ã—ã—ã¦å›ç­”</button>
    <button onclick="location.reload()" class="btn" style="background:#3498db; color:white;">æ¬¡ã®å•é¡Œã¸</button>
</div>

<script>
    // ã€ã“ã“ã«ã‚¹ãƒ†ãƒƒãƒ—1ã®CSV URLã‚’è²¼ã‚Šä»˜ã‘ã€‘
    const CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSU6s1sEI6R3RXqbdaR0am_PucJfqDyrMAY0NksHGMqzp_UJG-pwIkdvIXW5PuTdKbdPA7ztYDFUg_X/pub?gid=0&single=true&output=csv';

    let quiz = null;
    const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
    recognition.lang = 'ja-JP';

    async function start() {
        try {
            const r = await fetch(CSV_URL);
            const t = await r.text();
            const data = t.split(/\r?\n/).filter(v => v).map(row => {
                const c = row.split(',').map(v => v.replace(/"/g, "").trim());
                return { name: c[0], keys: c[1].split('|'), img: c[2] };
            }).filter(v => v.img.startsWith('http'));

            if (data.length > 0) {
                quiz = data[Math.floor(Math.random() * data.length)];
                document.getElementById('q-img').src = quiz.img;
                document.getElementById('status').innerText = "æº–å‚™å®Œäº†";
            }
        } catch (e) { document.getElementById('status').innerText = "ã‚¨ãƒ©ãƒ¼"; }
    }

    const btn = document.getElementById('mic-btn');
    btn.onmousedown = (e) => { e.preventDefault(); recognition.start(); };
    btn.onmouseup = () => { recognition.stop(); };
    btn.ontouchstart = (e) => { e.preventDefault(); recognition.start(); };
    btn.ontouchend = () => { recognition.stop(); };

    recognition.onresult = (e) => {
        const v = e.results[0][0].transcript;
        const ok = quiz.keys.some(k => v.includes(k)) || v.includes(quiz.name);
        document.getElementById('res').innerHTML = ok ? `<span style="color:green">æ­£è§£ï¼${quiz.name}</span>` : `<span style="color:red">æ®‹å¿µï¼š${v}</span>`;
    };
    start();
</script>
</body>
</html>
